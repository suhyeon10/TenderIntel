# 프롬프트 개선 사항 비교

## 📊 기존 vs 새로운 프롬프트 비교

### ❌ 기존 프롬프트의 문제점

#### 1. 구조적 문제
- **하드코딩**: `legal_rag_service.py`에 프롬프트가 직접 작성되어 있음
- **일관성 부족**: 각 메서드마다 프롬프트 형식이 다름
- **수정 어려움**: 프롬프트 수정 시 여러 곳을 찾아야 함
- **재사용 불가**: 다른 곳에서 같은 프롬프트를 사용하기 어려움

#### 2. 내용적 문제
- **구조 불명확**: 프론트엔드에서 원하는 구조와 불일치
  - 프론트엔드: 요약 결론 → 왜 위험한지 → 협상 포인트 → 참고 법령
  - 기존 프롬프트: 자유 형식으로 답변 요청
- **Dual RAG 미지원**: 계약서 내부 검색과 법령 검색이 분리되지 않음
- **이슈 컨텍스트 부족**: 선택된 이슈 정보가 명확히 전달되지 않음

#### 3. 예시: 기존 법률 상담 프롬프트
```python
# 기존 방식 (legal_rag_service.py 내부)
prompt = f"""당신은 법률 상담 전문가입니다. 사용자의 질문에 대해 이해하기 쉽고 실용적인 답변을 제공해주세요.

**중요한 원칙:**
1. 이 서비스는 법률 자문이 아닙니다...
2. 항상 관련 법령/가이드를 근거로 설명하세요...
3. 답변 마지막에 "전문가 상담 권장" 문구를 포함하세요...
4. 마크다운 형식을 사용하여 가독성을 높이세요...

사용자 질문:
{query}
{issue_context}
{analysis_context}

관련 법령/가이드/케이스:
{context}

위 정보를 바탕으로 사용자의 질문에 대해:
1. 명확하고 이해하기 쉬운 설명
2. 구체적인 행동 가이드
3. 관련 법령 근거
4. 추가 확인이 필요한 사항

을 포함하여 답변해주세요. 마크다운 형식으로 작성하세요."""
```

**문제점:**
- 구조가 모호함 (4가지 항목을 나열만 함)
- 프론트엔드 UI와 매칭되지 않음
- 계약서 청크와 법령 청크가 구분되지 않음

---

### ✅ 새로운 프롬프트의 개선점

#### 1. 구조적 개선
- **모듈화**: `core/prompts.py`로 분리
- **일관성**: 모든 프롬프트가 동일한 패턴 사용
- **재사용성**: 다른 곳에서도 쉽게 사용 가능
- **유지보수성**: 한 곳에서 모든 프롬프트 관리

#### 2. 내용적 개선
- **명확한 구조**: 프론트엔드 UI와 정확히 매칭
  ```
  ## 요약 결론
  ## 왜 위험한지 (법적 리스크)
  ## 실무 협상 포인트
  ## 참고 법령/표준 계약
  ```
- **Dual RAG 지원**: 계약서 청크와 법령 청크를 구분하여 제공
- **이슈 컨텍스트 강화**: 선택된 이슈 정보를 구조화하여 전달

#### 3. 예시: 새로운 법률 상담 프롬프트
```python
# 새로운 방식 (core/prompts.py)
LEGAL_CHAT_SYSTEM_PROMPT = """당신은 한국 노동법/계약 실무에 특화된 어시스턴트입니다.

**답변 구조:**
1. 요약 결론 (한 문장)
2. 왜 위험한지 (법적 리스크)
3. 실무 협상 포인트 (현실적인 옵션)
4. 참고 법령/표준 계약 요약
"""

def build_legal_chat_prompt(...):
    # 계약서 청크와 법령 청크를 구분하여 구성
    if contract_chunks:
        context_parts.append("=== 계약서 내용 ===")
        for chunk in contract_chunks[:3]:
            context_parts.append(f"제{chunk.article_number}조:\n{chunk.content}")
    
    if legal_chunks:
        context_parts.append("\n=== 관련 법령/가이드라인 ===")
        for chunk in legal_chunks[:5]:
            context_parts.append(f"[{chunk.source_type}] {chunk.title}\n{chunk.snippet}")
    
    prompt = f"""{LEGAL_CHAT_SYSTEM_PROMPT}
    
    위 정보를 바탕으로 사용자의 질문에 대해 다음 구조로 답변해주세요:
    
    ## 요약 결론
    [한 문장으로 핵심 답변]
    
    ## 왜 위험한지 (법적 리스크)
    [관련 법령을 근거로 위험성 설명]
    
    ## 실무 협상 포인트
    [현실적인 협상 옵션과 대안 제시]
    
    ## 참고 법령/표준 계약
    [관련 법령 요약 및 출처]
    """
```

**개선점:**
- ✅ 명확한 4단계 구조
- ✅ 프론트엔드 UI와 정확히 매칭
- ✅ 계약서와 법령 구분
- ✅ 마크다운 헤딩으로 구조화

---

## 📈 개선 효과

### 1. 프론트엔드 매칭도 향상
**기존:**
- LLM이 자유 형식으로 답변
- 프론트엔드에서 파싱 어려움
- 구조가 일관되지 않음

**개선:**
- 명확한 마크다운 헤딩 구조
- 프론트엔드에서 쉽게 파싱 가능
- 항상 동일한 구조 보장

### 2. 답변 품질 향상
**기존:**
- "명확하고 이해하기 쉬운 설명" (모호함)
- "구체적인 행동 가이드" (구체성 부족)

**개선:**
- "요약 결론 (한 문장)" (명확함)
- "실무 협상 포인트 (현실적인 옵션)" (구체적)

### 3. 컨텍스트 활용 개선
**기존:**
- 계약서와 법령이 섞여 있음
- 이슈 정보가 명확하지 않음

**개선:**
- 계약서 청크와 법령 청크 구분
- 선택된 이슈 정보 구조화
- 조항 번호 기반 매핑

---

## 🎯 실제 사용 예시

### 기존 방식
```
사용자: "수습 기간 해고 조건은 어떻게 되나요?"

LLM 답변 (자유 형식):
수습 기간 중 해고에 대해서는 근로기준법 제27조에 규정되어 있습니다.
일반적으로 수습 기간은 3개월을 넘을 수 없으며...
[구조가 일관되지 않음]
```

### 새로운 방식
```
사용자: "수습 기간 해고 조건은 어떻게 되나요?"

LLM 답변 (구조화):
## 요약 결론
수습 기간 중 해고는 근로기준법 제27조에 따라 정당한 사유가 있어야 하며, 
3개월을 초과할 수 없습니다.

## 왜 위험한지 (법적 리스크)
현재 계약서의 제5조는 수습 기간을 6개월로 규정하고 있어 근로기준법에 위반됩니다.
또한 해고 사유가 불명확하여 부당해고 소지가 있습니다.

## 실무 협상 포인트
1. 수습 기간을 3개월로 단축 요청
2. 해고 사유를 구체적으로 명시 요청
3. 수습 기간 중에도 정당한 사유 없이는 해고 불가 명시

## 참고 법령/표준 계약
- 근로기준법 제27조: 수습 기간은 3개월을 초과할 수 없음
- 표준근로계약서: 수습 기간 해고 사유 명시 필수
```

---

## ✅ 결론

**새로운 프롬프트가 더 나은 이유:**

1. **구조화**: 프론트엔드 UI와 정확히 매칭되는 4단계 구조
2. **일관성**: 모든 답변이 동일한 형식으로 제공
3. **유지보수성**: 한 곳에서 관리 가능
4. **확장성**: Dual RAG, 이슈 컨텍스트 등 추가 기능 지원
5. **품질**: 명확한 지시로 더 나은 답변 생성

**기존 프롬프트는** 자유 형식으로 답변을 요청하여 일관성이 부족했지만,  
**새로운 프롬프트는** 구조화된 형식으로 프론트엔드와 완벽하게 매칭됩니다.

